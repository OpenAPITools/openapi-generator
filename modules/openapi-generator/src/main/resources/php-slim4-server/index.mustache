<?php

{{>licenseInfo}}

/**
 * NOTE: This class is auto generated by the openapi generator program.
 * https://github.com/openapitools/openapi-generator
 */{{#apiInfo}}

require_once __DIR__ . '/vendor/autoload.php';

use {{invokerPackage}}\SlimRouter;
use Psr\Http\Message\ServerRequestInterface;
use Psr\Http\Message\ResponseInterface;
use OpenAPIServer\Mock\OpenApiDataMocker;
{{/apiInfo}}

$config = [];

/**
 * Token Middleware 1.x Options
 * Options `header`, `regex`, `parameter`, `cookie`, `attribute`, `path`, `except`, `authenticator`
 * are handled by SlimRouter class. These options are ignored by app and they omitted from current
 * example.
 * Ref: https://github.com/dyorg/slim-token-authentication/tree/1.x
 */
$config['tokenAuthenticationOptions'] = [
    /**
     * Tokens are essentially passwords. You should treat them as such and you should always
     * use HTTPS. If the middleware detects insecure usage over HTTP it will return unathorized
     * with a message Required HTTPS for token authentication. This rule is relaxed for requests
     * on localhost. To allow insecure usage you must enable it manually by setting secure to
     * false.
     * Default: true
     */
    // 'secure' => true,

    /**
     * Alternatively you can list your development host to have relaxed security.
     * Default: ['localhost', '127.0.0.1']
     */
    // 'relaxed' => ['localhost', '127.0.0.1'],

    /**
     * By default on ocurred a fail on authentication, is sent a response on json format with a
     * message (`Invalid Token` or `Not found Token`) and with the token (if found), with status
     * `401 Unauthorized`. You can customize it by setting a callable function on error option.
     * Default: null
     */
    // 'error' => null,
];

/**
 * Mocker Middleware options.
 */
$mocker = new OpenApiDataMocker();
$mocker->setModelsNamespace('{{modelPackage}}\\');
$config['mockerOptions'] = [
    // 'dataMocker' => $mocker,

    // 'getMockStatusCodeCallback' => function (ServerRequestInterface $request, $responses) {
    //     // check if client clearly asks for mocked response
    //     $pingHeader = 'X-{{invokerPackage}}-Mock';
    //     $pingHeaderCode = 'X-{{invokerPackage}}-Mock-Code';
    //     if (
    //         $request->hasHeader($pingHeader)
    //         && $request->getHeader($pingHeader)[0] === 'ping'
    //     ) {
    //         $responses = (array) $responses;
    //         $requestedResponseCode = ($request->hasHeader($pingHeaderCode)) ? $request->getHeader($pingHeaderCode)[0] : 'default';
    //         if (array_key_exists($requestedResponseCode, $responses)) {
    //             return $requestedResponseCode;
    //         }

    //         // return first response key
    //         reset($responses);
    //         return key($responses);
    //     }

    //     return false;
    // },

    // 'afterCallback' => function ($request, $response) {
    //     // mark mocked response to distinguish real and fake responses
    //     return $response->withHeader('X-{{invokerPackage}}-Mock', 'pong');
    // },
];

$router = new SlimRouter($config);
$app = $router->getSlimApp();

/**
 * The routing middleware should be added before the ErrorMiddleware
 * Otherwise exceptions thrown from it will not be handled
 */
$app->addRoutingMiddleware();

/**
 * Add Error Handling Middleware
 *
 * @param bool $displayErrorDetails -> Should be set to false in production
 * @param bool $logErrors -> Parameter is passed to the default ErrorHandler
 * @param bool $logErrorDetails -> Display error details in error log
 * which can be replaced by a callable of your choice.

 * Note: This middleware should be added last. It will not handle any exceptions/errors
 * for middleware added after it.
 */
$app->addErrorMiddleware(false, true, true);

$app->run();
