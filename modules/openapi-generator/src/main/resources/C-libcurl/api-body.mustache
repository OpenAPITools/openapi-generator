#include <stdlib.h>
#include <stdio.h>
#include "apiClient.h"
#include "cJSON.h"
{{#imports}}{{{import}}}
{{/imports}}

#define MAX_BUFFER_LENGTH 4096
#define intToStr(dst, src) \
    do {\
    char dst[64];\
    snprintf(dst, 64, "%ld", (long int)(src));\
}while(0)

{{#operations}}
{{#operation}}
{{#summary}}
// {{{summary}}}
//
{{/summary}}
{{#notes}}
// {{{notes}}}
//
{{/notes}}
{{#returnType}}{{{.}}}_t{{/returnType}}{{^returnType}}void{{/returnType}} *{{{classname}}}_{{{operationId}}}(apiClient_t *apiClient{{#allParams}}, {{{dataType}}}{{#isListContainer}}_t*{{/isListContainer}}{{^isListContainer}}{{#isPrimitiveType}}{{#isString}}*{{/isString}}{{/isPrimitiveType}}{{^isPrimitiveType}}_t*{{/isPrimitiveType}}{{/isListContainer}} {{paramName}}{{/allParams}}) {
    list_t    *localVarQueryParameters,
    list_t    *localVarHeaderParameters,
    list_t    *localVarFormParameters,
    char      *localVarBodyParameters,

    // create the path
   char *localVarPath = malloc(MAX_BUFFER_LENGTH);
   snprintf(localVarPath, MAX_BUFFER_LENGTH, "{{{path}}}");

    {{#pathParams}}
    // TODO path parameter {{paramName}} ({{baseName}}) not yet supported
    // TODO base path = {{{basePath}}}
    char* baseNameMod = malloc(strlen({{baseName}})+2); //baseNameMod free not yet implemented
    snprintf(baseNameMod, strlen(baseName)+3, "%s%s%s", "{", {{baseName}}, "}");
    {{#paramName}}
    {{#isLong}}
    char buff[64];
    intToStr(buf, {{paramName}});
    localVarPath = strReplace(localVarPath, baseNameMod, buff);
    {{/isLong}}
    {{#isString}}
    localVarPath = strReplace(localVarPath, baseNameMod, {{paramName}});
    {{/isString}}
    {{/paramName}}
    {{/pathParams}}

    {{#headerParams}}
    // TODO header parameters
    // header parameter {{paramName}} ({{baseName}}) not yet supported
    {{/headerParams}}

    {{#queryParams}}
    // TODO query parameters
    // query parameter {{paramName}} ({{baseName}}) not yet supported
    char *{{baseName}} = malloc(MAX_BUFFER_LENGTH);

    {{/queryParams}}
    {{#formParams}}
    // TODO form parameters
    // form parameter {{paramName}} ({{baseName}}) not yet supported

    {{/formParams}}
    {{#bodyParam}}
    // JSON HTTP Request - {{{baseName}}}
    cJSON *{{{paramName}}}JSONObject;
    {{{paramName}}}JSONObject = {{dataType}}_convertToJSON({{paramName}});
    localVarBodyParameters = cJSON_Print({{{paramName}}}JSONObject);

    {{/bodyParam}}
   apiClient_invoke(apiClient,
                    "pet",
                    localVarPath,
                    localVarQueryParameters,
                    localVarHeaderParameters,
                    localVarFormParameters,
                    localVarBodyParameters,
                    "{{{httpMethod}}}");

   free(apiClient->dataReceived);
   {{#allParams}}
   {{^bodyParam}}
   free({{{paramName}}}String);
   {{/bodyParam}}
   {{#bodyParam}}
    free(localVarBodyParameters);
   cJSON_Delete()
   {{/bodyParam}}
   {{/allParams}}
    {{#returnType}}
    localVar{{{returnType}}} = {{complexType}}_parseFromJSON(apiClient->dataReceived);
    if(localVar{{{returnType}}} == NULL) {
        return 0;
    } else {
        cJSON *jsonObject = {{complexType}}_convertToJSON({{complexType}});
        cJSON_Delete(jsonObject);
    }

   return localVar{{{returnType}}};
   {{/returnType}}
    {{^returnType}}
   return;
   {{/returnType}}

}

{{/operation}}
{{/operations}}


