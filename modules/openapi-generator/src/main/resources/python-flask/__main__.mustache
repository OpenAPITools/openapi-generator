{{#supportPython2}}
#!/usr/bin/env python
{{/supportPython2}}
{{^supportPython2}}
#!/usr/bin/env python3
{{/supportPython2}}

import connexion
{{#featureCORS}}
from flask_cors import CORS
{{/featureCORS}}

from {{packageName}} import encoder


def main():
    app = connexion.App(__name__, specification_dir='./openapi/')
    app.app.json_encoder = encoder.JSONEncoder

    # Switch needed to make the error messages sensible:
    # Any missing mandatory query params will throw a fault that includes the name of the missing param.
    # However, for some reason form params are treated entirely differently and don't include 
    # the missing param name in the fault and the default error response is totally different too.
    # Setting the flag below at least ensures that the error message contains the missing param name 
    # which can save a ton of time trying to figure out issues.
    # See https://github.com/pallets/flask/issues/3249 
    app.app.config['TRAP_BAD_REQUEST_ERRORS'] = True 

    app.add_api('openapi.yaml',
                arguments={'title': '{{appName}}'},
                pythonic_params=True)

{{#featureCORS}}
    # add CORS support
    CORS(app.app)

{{/featureCORS}}
    app.run(port={{serverPort}})


if __name__ == '__main__':
    main()
