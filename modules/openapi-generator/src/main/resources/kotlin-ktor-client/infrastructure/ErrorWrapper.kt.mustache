package {{packageName}}.infrastructure

import io.ktor.client.call.typeInfo
import io.ktor.client.features.BadResponseStatusException
import io.ktor.client.features.json.serializer.KotlinxSerializer

class ErrorWrapper(
    val originalException: BadResponseStatusException,
    val error: Any
) : Exception()

internal suspend inline fun <reified E>KotlinxSerializer.parseAndWrapErrorResponse(exception: BadResponseStatusException): ErrorWrapper {
    val error = read(typeInfo<E>(), exception.response)
    return ErrorWrapper(exception, error)
}