package {{packageName}}.infrastructure

import io.ktor.client.call.typeInfo
import io.ktor.client.features.BadResponseStatusException
import io.ktor.client.features.json.serializer.KotlinxSerializer

{{#nonPublicApi}}internal {{/nonPublicApi}}class ErrorWrapper(
    val originalException: BadResponseStatusException,
    val error: Any?
) : Exception()

internal suspend inline fun <reified E>KotlinxSerializer.parseAndWrapErrorResponse(exception: BadResponseStatusException): ErrorWrapper {
    val error: Any? = try { read(typeInfo<E>(), exception.response) } catch(ignored: Throwable) {null}
    return ErrorWrapper(exception, error)
}