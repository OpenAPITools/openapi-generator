package {{packageName}}.infrastructure.authentication

{{#nonPublicApi}}internal {{/nonPublicApi}}class ApiKeyAuth(
    private val location: Location,
    private val paramName: String,
    private val apiKey: String,
    private val apiKeyPrefix: String?
): AuthProvider {

    enum class Location {
        query, header
    }

    data class Config(
        val apiKey: String,
        val apiKeyPrefix: String? = null
    )

    constructor(location: Location, paramName: String, config: Config)
            : this(location, paramName, config.apiKey, config.apiKeyPrefix)

    override fun applyToParams(
        queryParameters: MutableList<Pair<String, Any?>>,
        headerParameters: MutableList<Pair<String, Any?>>
    ) {
        val value = if (apiKeyPrefix.isNullOrBlank()) {
            apiKey
        } else {
            "$apiKeyPrefix $apiKey"
        }

        when (location) {
            Location.query -> queryParameters += paramName to value
            Location.header -> headerParameters += paramName to value
        }
    }
}