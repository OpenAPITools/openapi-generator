# coding=utf-8

{{>partials/header.py}}
from __future__ import (absolute_import, division, print_function)
__metaclass__ = type

from marshmallow import Schema, INCLUDE, post_load, post_dump

__all__ = ['SchemaBase']


class SchemaBase(Schema):
    """
    Marshmallow schema settings

    {{>partials/auto_generated_class_docblock}}

    '__' suffix used on methods to prevent collissions with field names (which may end with _)
    """

    @property
    def __model__(self):
        """The Model Object that this Schema deserializes to."""
        raise NotImplementedError

    @post_load
    def make_object__(self, data):
        return self.__model__(**data)

    @post_dump
    def validate_on_serialize__(self, data):
        """
        :param dict data: dictionary of serialized data (uplink converts this to a json string)
        :return:
        """
        # NOTE: validate, unfortunately, does an entire load/serialize to run the validators
        # So, every dump will dump and then load (discarding the loaded value)
        self.validate(data)  # raises ValidationError
        return data

    class Meta:
        # Client models must be tolerant to the server adding new fields. The Zalando specs do a good job of explaining
        # why this is important in API extensibility: https://opensource.zalando.com/restful-api-guidelines/#108
        # So, tell marshmallow to silently include unknown fields.
        # https://marshmallow.readthedocs.io/en/3.0/quickstart.html#handling-unknown-fields
        unknown = INCLUDE
