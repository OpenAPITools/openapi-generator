#
# OpenAPI Petstore
# This is a sample server Petstore server. For this sample, you can use the api key `special-key` to test the authorization filters.
# Version: 1.0.0
# Generated by OpenAPI Generator: https://openapi-generator.tech
#

Describe -tag 'PSOpenAPITools' -name 'Integration Tests' {
    Context 'Pet' {
        It 'CRUD tests' {
            $Id = 38369

            # Add pet
            $Pet = New-Pet -Id $Id -Name 'PowerShell' -Category (
                New-Category -Id $Id -Name 'PSCategory'
            ) -PhotoUrls @(
                'http://example.com/foo',
                'http://example.com/bar'
            ) -Tags (
                New-Tag -Id $Id -Name 'PSTag'
            ) -Status Available
            $Result = Invoke-PetApiAddPet -Body $Pet
            
            # Get 
            $Result = Invoke-PetApiGetPetById -petId $Id
            $Result."id" | Should Be 38369
            $Result."name" | Should Be "PowerShell"
            $Result."status" | Should Be "Available"

            # Update (form)
            $Result = Invoke-PetApiUpdatePetWithForm -petId $Id -Name "PowerShell Update" -Status "Pending"

            $Result = Invoke-PetApiGetPetById -petId $Id
            $Result."id" | Should Be 38369
            $Result."name" | Should Be "PowerShell Update"
            $Result."status" | Should Be "Pending"

            # Update (put)
            $NewPet = New-Pet -Id $Id -Name 'PowerShell2' -Category (
                New-Category -Id $Id -Name 'PSCategory2'
            ) -PhotoUrls @(
                'http://example.com/foo2',
                'http://example.com/bar2'
            ) -Tags (
                New-Tag -Id $Id -Name 'PSTag2'
            ) -Status Sold

            $Result = Invoke-PetApiUpdatePet -Body $NewPet
            $Result = Invoke-PetApiGetPetById -petId $Id
            $Result."id" | Should Be 38369
            $Result."name" | Should Be "PowerShell2"
            $Result."status" | Should Be "Sold"

            # upload file
            $file = Get-Item "./plus.gif"
            $Result = Invoke-PetApiUploadFile -petId $Id -additionalMetadata "Additional data" -File $file

            # Delete
            $Result = Invoke-PetApiDeletePet -petId $Id

        }
    }
}
