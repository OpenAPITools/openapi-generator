# Spring HTTP Interface with OAuth2 (@ClientRegistrationId)

This sample demonstrates the use of the `@ClientRegistrationId` annotation with Spring HTTP Interface clients.

## Overview

This code was generated by the [OpenAPI Generator](https://openapi-generator.tech) project.
When generating Spring HTTP Interface clients, you can specify a `clientRegistrationId` parameter to automatically add the `@ClientRegistrationId` annotation to all generated API interfaces.

## Configuration

Add the `clientRegistrationId` property to your generator configuration:

```yaml
generatorName: spring
library: spring-http-interface
additionalProperties:
  clientRegistrationId: "petstore-oauth"
```

Or via command line:

```bash
openapi-generator-cli generate \
  -g spring \
  --library spring-http-interface \
  --additional-properties clientRegistrationId=petstore-oauth \
  -i petstore.yaml \
  -o ./output
```

## Generated Code

The generated interface will include the `@ClientRegistrationId` annotation at the class level:

```java
@ClientRegistrationId("petstore-oauth")
public interface PetApi {

    @HttpExchange(
        method = "GET",
        value = "/pet/{petId}",
        accept = { "application/json" }
    )
    ResponseEntity<PetDto> getPetById(@PathVariable("petId") Long petId);
}
```

## Spring Security Integration

This annotation is part of Spring Security's OAuth2 integration for HTTP Service Clients. It automatically associates OAuth2 tokens with HTTP requests.

### Requirements

- Spring Boot 3.5+
- Spring Security 6.5+

### Application Properties

Configure your Spring application with the OAuth2 client registration:

```yaml
spring:
  security:
    oauth2:
      client:
        registration:
          petstore-oauth:
            client-id: your-client-id
            client-secret: your-client-secret
            authorization-grant-type: client_credentials
            scope: read,write
        provider:
          petstore-oauth:
            token-uri: https://auth.example.com/oauth/token
```

### Bean Configuration

Configure your HTTP Interface beans with OAuth2 support using `RestClient` and the `OAuth2ClientHttpRequestInterceptor`:

```java
@Configuration
public class HttpInterfaceConfig {

    @Bean
    public PetApi petApi(RestClient.Builder builder, OAuth2AuthorizedClientManager authorizedClientManager) {
        OAuth2ClientHttpRequestInterceptor interceptor =
            new OAuth2ClientHttpRequestInterceptor(authorizedClientManager);

        RestClient restClient = builder
            .baseUrl("https://petstore.example.com/v2")
            .requestInterceptor(interceptor)
            .build();

        HttpServiceProxyFactory factory = HttpServiceProxyFactory
            .builderFor(RestClientAdapter.create(restClient))
            .build();

        return factory.createClient(PetApi.class);
    }
}
```

## References

- [Spring Security HTTP Service Client Integration](https://docs.spring.io/spring-security/reference/servlet/oauth2/client/http-service-client.html)
- [Spring Framework HTTP Interface](https://docs.spring.io/spring-framework/reference/integration/rest-clients.html#rest-http-interface)
